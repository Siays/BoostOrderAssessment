<Window x:Class="BoostOrderAssessment.Views.CartWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:BoostOrderAssessment.Converters"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Cart" Height="600" Width="450" WindowStartupLocation="CenterScreen"
        Background="#FAFAFA">
    <Window.Resources>
        <conv:IndexToOneBasedConverter x:Key="IndexToOneBasedConverter"/>
    </Window.Resources>
    <Grid>
        <!-- Define header, content, footer -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Cart Items -->
            <RowDefinition Height="Auto"/>
            <!-- Summary -->
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Border Background="#00AEEF" Grid.Row="0" Height="50" Padding="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>

                <!-- Back Arrow -->
                <Button Grid.Column="0" Width="40" Height="50" Background="Transparent" BorderThickness="0" Padding="0" Click="BackButton_Click">
                    <TextBlock Text="&#x2039;" FontSize="20" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Button>

                <!-- Title -->
                <TextBlock Grid.Column="1" Text="Cart" FontSize="18" Foreground="White" VerticalAlignment="Center"/>

                <!-- Company Name -->
                <TextBlock Grid.Column="2" Text="Company Name" FontSize="14" Foreground="White" VerticalAlignment="Center" Margin="0,0,10,0"/>

                <!-- Company Initials Circle -->
                <Border Grid.Column="3" Width="32" Height="32" CornerRadius="16" Background="White" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,10,0">
                    <TextBlock Text="CN" Foreground="#00AEEF" FontWeight="Bold" FontSize="14" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Border>

                <!-- Menu (three dots) -->
                <Button Grid.Column="4" Width="40" Height="50" Background="Transparent" BorderThickness="0" Padding="0"
                    Click="MenuButton_Click">
                    <TextBlock Text="&#x22EE;" FontSize="18" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Clear Cart" Command="{Binding ClearCartCommand}" />
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>

            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <!-- Only one row here, everything scrolls together -->
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- CART ITEMS -->
                    <ItemsControl ItemsSource="{Binding CartItems}" AlternationCount="1000">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White" BorderBrush="#EEE" BorderThickness="0,0,0,1" Padding="10">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <!-- LEFT SIDE -->
                                        <StackPanel>
                                            <!-- Index + SKU + Stock -->
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, 
                                                          Path=(ItemsControl.AlternationIndex), 
                                                          Converter={StaticResource IndexToOneBasedConverter}}"
                                                   FontWeight="Bold"
                                                   Foreground="#333"/>
                                                <TextBlock Text="{Binding Sku, StringFormat={}{0} }"
                                                   Foreground="#888" Margin="4,0,0,0"/>
                                                <TextBlock Text="{Binding Product.StockDisplay}" 
                                                   FontSize="12" Foreground="#4CAF50" 
                                                   FontWeight="SemiBold" Margin="8,0,0,0"/>
                                            </StackPanel>

                                            <!-- Product Name -->
                                            <TextBlock Text="{Binding ProductName}" 
                                               FontWeight="Bold" FontSize="14" Margin="0,2,0,0"/>

                                            <!-- Price -->
                                            <TextBlock Text="{Binding UnitPrice, StringFormat=RM{0:F2}}" 
                                               FontWeight="Bold" FontSize="14" Margin="0,2,0,0"/>
                                        </StackPanel>

                                        <!-- RIGHT SIDE -->
                                        <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                            <!-- Delete Button + Image side by side -->
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                                <!-- DELETE BUTTON (left of image) -->
                                                <Button x:Name="RemoveItemButton" 
                                                    Command="{Binding DataContext.RemoveFromCartCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" 
                                                    ToolTip="Remove item"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    Width="30" 
                                                    Height="30"
                                                    Foreground="Black">
                                                    <materialDesign:PackIcon Kind="CartRemove" Width="18" Height="18"/>
                                                </Button>
                                                <!-- IMAGE -->
                                                <Border Width="40" Height="40" Background="#F0F0F0" CornerRadius="8"
                                                    BorderBrush="#E0E0E0" BorderThickness="1" HorizontalAlignment="Right">
                                                    <Image Stretch="UniformToFill">
                                                        <Image.Source>
                                                            <PriorityBinding>
                                                                <Binding Path="ImageUrl" />
                                                                <Binding Source="/BoostOrderAssessment;component/Assets/img_placeholder.png" />
                                                            </PriorityBinding>
                                                        </Image.Source>
                                                    </Image>
                                                </Border>

                                                
                                            </StackPanel>

                                            <!-- ORDER + TOTAL -->
                                            <Grid Margin="0,8,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="20"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Blue bar -->
                                                <Border Grid.Column="0" Width="4" Background="#0071CE" Margin="0,0,6,0" CornerRadius="2"/>

                                                <!-- Order text -->
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="Order" Foreground="#888" FontSize="11"/>
                                                    <TextBlock Text="{Binding Quantity, StringFormat={}{0} UNIT}" 
                                                        FontWeight="Bold"/>
                                                </StackPanel>

                                                <!-- Arrow -->
                                                <TextBlock Grid.Column="2" Text=">" FontWeight="Bold" Foreground="#0071CE" 
                                                        VerticalAlignment="Center" HorizontalAlignment="Center"/>

                                                <!-- Orange bar -->
                                                <Border Grid.Column="3" Width="4" Background="#F9A825" Margin="6,0,6,0" CornerRadius="2"/>

                                                <!-- Total text -->
                                                <StackPanel Grid.Column="4" VerticalAlignment="Center">
                                                    <TextBlock Text="Total" Foreground="#888" FontSize="11"/>
                                                    <TextBlock Text="{Binding LineTotal, StringFormat=RM{0:F2}}" 
                                                        FontWeight="Bold"/>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>

                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- TOTAL ROW (Now appears after last item in scroll) -->
                    <Border Background="White" Padding="10,8" BorderBrush="#EEE" BorderThickness="0,1,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Total" FontWeight="Bold" FontSize="14"/>
                            <TextBlock Text="{Binding CartTotal, StringFormat=RM{0:F2}}" 
                               FontWeight="Bold" FontSize="14" Grid.Column="1"/>
                        </Grid>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- SUMMARY -->
        <Border Grid.Row="2" Background="White" Padding="10,8" Height="60">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="{Binding SummaryText}" FontSize="13" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding CartTotal, StringFormat=RM{0:F2}}" FontWeight="Bold" FontSize="13" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Grid.Column="1" VerticalAlignment="Center">
                    <Button Content="Checkout" Width="110" Height="36" Background="#00AEEF" Foreground="White" FontWeight="Bold" BorderThickness="0">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" CornerRadius="18">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
